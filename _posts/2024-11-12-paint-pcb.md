---
title: "PCBs con el paint, paciencia y dosis de cutrez"
description: "Creando prototipos con el paint y protoboards soldables"
date: 2024-11-12 16:00
categories: electronica
header:
  og_image: /assets/images/paint_pcb/og_image.jpg
---
Creo que despu√©s de tantos retoques al art√≠culo del portapack iba tocando hacer un post
nuevo. La gente cercana suele decir que soy un poco rata, eso es un bulo sin fundamentos.
De todos modos, sin tener relaci√≥n alguna, voy a ense√±aros c√≥mo he hecho √∫ltimamente
algunas placas de "prototipo" (permanente) con placas de prototipos para soldar y de 
forma barata.

# 1. Preludio al cutrismo
El primer motivo para ello es que a veces necesitas algo concreto y no lo venden ya
montado. El segundo que si viene montado cuesta 4x de lo que costar√≠a ensamblarlo a mano
(ah√≠ tenemos los m√≥dulos de flipper zero a 40 o 50‚Ç¨ con 3-4 m√≥dulos de arduino que 
cuestan 2-3‚Ç¨ cada uno).

Y claro, t√∫ pensar√°s que porque no dise√±ar las placas y mandarlas a PCBWay para que me
las fabriquen y ya soldar los componentes con una placa en condiciones... Pues porque...
¬°Aqu√≠ el espiritu es ser cutre, vago, rata y desordenado!

Y es que en aliexpress tienes 10 placas para soldar prototipos por menos de 2‚Ç¨:

![Pack 10 pcbs 5x7cm]({{site.url}}/assets/images/paint_pcb/pack_ten_pcbs.png "Pack de 10 placas para soldar de 5x7cm")

Siempre las pido de ese tama√±o, es perfecto, es m√°s que suficiente para satisfacer a un 
maker, todo lo dem√°s es vicio, perversi√≥n y socialismo.

Yo siempre las he usado mucho para pasar cosas de la protoboard a cosas que quiero que no
se desmonten ya. Aunque es verdad que alguna la he "deshecho", igual en un futuro escribo
un art√≠culo explicando como quito los componentes soldados de una. La cuesti√≥n es que uno 
acaba harto de tener la protoboard con cables colgando y los modulos ah√≠ pinchados, 
porque son m√°s aparatosos y a la m√≠nima est√°n fallando las conexiones o solt√°ndose cosas.
De verdad, que es un co√±azo si es algo que no quieres desmontar, y he llegado a tener
prototipos as√≠ durante varios meses jaja

Antes lo que hac√≠a era soldar los m√≥dulos con la suficiente separaci√≥n para poder juntar
los pines con los cables y luego ir cableando. Y toda la placa era con cablecitos por
encima. Pero esto es tremendo rollo y adem√°s tiene m√°s riesgo de fallos.

> Cuando hablo de tener la suficiente separaci√≥n me refiero a dejar un agujero para el
  pin y uno circundante para unirlo al cable u otro pin. Es algo que veremos ahora.

Voy a aprovechar un proyecto de APRS con Lora para ense√±aros el proceso que sigo para
realizar el dise√±o y construcci√≥n. Dejo debajo el enlace a wikipedia de APRS, b√°sicamente
es un sistema para mandarse mensajes autom√°tizados por radio, pero una de las cosas m√°s 
t√≠picas es usarlo para ir mandando paquetes con la posici√≥n GPS del cacharro.

Los radiofrikis usan esto por hacer pruebas de alcance. S√≥lo hay que met√©rselo en el
bolsillo e ir a andar, luego vas a internet y ves si qui√©n ha recibido tus paquetes üòÄ.
Adem√°s usando lora se consiguen distancias sorprendentes con poca potencia y hardware 
barato (y eso nos gusta).

Me viene bien porque esto se divide en dos proyectos:
1. Un geolocalizador que env√≠a la posici√≥n GPS por lora (*APRS Lora Tracker*)
2. Una estaci√≥n lora que recibe los paquetes y los reporta por internet (*APRS Lora iGate*)

En el caso de este art√≠culo ya ten√≠a hecho el tracker, que me ha dado problemas pero
funciona, que hice con el m√©todo co√±azo de ir poniendo cablecitos. As√≠ que me centrar√© en
el iGate/digipeater.

Y bueno, aprovecho para ense√±ar que uno muchas veces puede coger un proyecto FLOSS sin
miedo y adaptarlo a sus necesidades. Ya que me toc√≥ a√±adir ciertos cambios muy sencillos
al c√≥digo.

Para que haya una referencia del m√©todo anterior pongo fotos de como est√° montado el
tracker:

![DIY APRS Lora Tracker]({{site.url}}/assets/images/paint_pcb/lora_diy_tracker.jpg "Tracker APRS casero con lora")

Se puede ver que tiene demasiados cablecitos para unir los m√≥dulos. Lo desmonto para que
se vea todo (ignoremos los destrozos que le he hecho a la placa y a la caja con el 
minitaladro):

![DIY APRS Lora Tracker disassembled]({{site.url}}/assets/images/paint_pcb/lora_diy_tracker_disassembled.jpg "Tracker APRS casero con lora desmontado")

Y si ense√±o la placa por detr√°s se puede ver que toda la l√≥gica de "pistas" son los
cables que van por la cara de arriba y aqu√≠ hay poco que rascar:

![DIY APRS Lora Tracker pcb back]({{site.url}}/assets/images/paint_pcb/lora_diy_tracker_pcb_back.jpg "Parte trasera de la placa del tracker")

Adem√°s de ser inc√≥modo de "fabricar" as√≠, luego cuesta m√°s de buscar fallos con el
pol√≠metro porque los cables se enmara√±an algo. Esto nos lleva al proceso que voy a
explicar y con ello acabo esta introducci√≥n densa.

# 2. Poniendo el foco en el proyecto que nos incumbe
Como he mencionado antes, el proyecto en el que me centrar√© es en el iGate que se
encuentra en [GitHub](https://github.com/richonguzman/LoRa_APRS_iGate).

Este proyecto tiene un mont√≥n de placas configuradas para poder programar, pero yo decid√≠
crearlo a mano usando el esp32-c3 supermini y asignando yo las conexiones que vi que 
funcionaban sin problemas. Esta placa est√° chiquita como podr√≠as suponer por su nombre y
es especialmente barata. Eso s√≠, los pines son limitados, hay que dosificarlos como si
realmente fuesen caros.

![GPIO esp32-c3 supermini]({{site.url}}/assets/images/paint_pcb/esp32-c3-super-mini.png "GPIO del esp32-c3 supermini")

El proyecto est√° hecho con PlatformIO. Tuve que modificar y a√±adir alguna cosilla. ¬°Eso 
es lo guay del FLOSS!

Aqu√≠ una traza del diff para qu√© pod√°is ver los cambios que apliqu√© para que funcionase:

```diff
--- a/.github/workflows/build.yml
+++ b/.github/workflows/build.yml
@@ -77,6 +77,8 @@ jobs:
                       chip: esp32c3
                     - name: QRPLabs_LightGateway_1_0
                       chip: esp32s3
+                    - name: ESP32_C3_SUPERMINI
+                      chip: esp32c3
         steps:
             - uses: actions/checkout@v3

--- a/platformio.ini
+++ b/platformio.ini
@@ -480,6 +480,29 @@ build_flags =
     -DHAS_SX1262
        -DARDUINO_USB_MODE=1
        -DARDUINO_USB_CDC_ON_BOOT=1
 lib_deps =
        ${common.lib_deps}
        ${common.display_libs}
+[env:ESP32_C3_SuperMini]
+board = lolin_c3_mini
+build_flags =
+       ${common.build_flags}
+       -DESP32_C3_SUPERMINI
+       -DHAS_SX1278
+       -DARDUINO_USB_MODE=1
+       -DARDUINO_USB_CDC_ON_BOOT=1
+lib_deps =
+       ${common.lib_deps}
+       ${common.display_libs}

--- a/src/boards_pinout.h
+++ b/src/boards_pinout.h
@@ -187,7 +187,7 @@
 #endif


-#if !defined(HELTEC_HTCT62) && !defined(HELTEC_WSL_V3) && !defined(ESP32C3_DIY_1W_LoRa) && !defined(ESP32C3_DIY_1W_LoRa_915) && !defined(WEMOS_S2_MINI_DIY_LoRa)
+#if !defined(HELTEC_HTCT62) && !defined(HELTEC_WSL_V3) && !defined(ESP32C3_DIY_1W_LoRa) && !defined(ESP32C3_DIY_1W_LoRa_915) && !defined(WEMOS_S2_MINI_DIY_LoRa)
     #define HAS_DISPLAY
 #endif

@@ -277,6 +277,35 @@
     #define RADIO_BUSY_PIN      8
 #endif

+#if defined(ESP32_C3_SUPERMINI)
+    // intentar evitar usar 2 (boot mode / strapping pin), 8 (Blue status_led (inverted), boot mode / strapping pin) y 9 (Boot mode / strapping pin, boot button)
+    #define RADIO_SCLK_PIN   4
+    #define RADIO_MISO_PIN   5
+    #define RADIO_MOSI_PIN   6
+    #define RADIO_CS_PIN     7
+    #define RADIO_RST_PIN    3
+    #define RADIO_BUSY_PIN  10
+    #define OLED_SDA         0
+    #define OLED_SCL         1
+    #define OLED_RST        -1
+    //#define GPS_TX          20
+    //#define GPS_RX          21
+#endif
+
 #ifdef LIGHTGATEWAY_1_0
     #define BUTTON_PIN          0
     #define INTERNAL_LED_PIN    16

--- a/src/power_utils.cpp
+++ b/src/power_utils.cpp
@@ -205,7 +205,7 @@ 
namespace POWER_Utils {
             Wire1.begin(BOARD_I2C_SDA, BOARD_I2C_SCL);
         #endif

-        #if defined(HELTEC_V3) || defined(HELTEC_WS) || defined(LIGHTGATEWAY_1_0) || defined(TTGO_LORA32_T3S3_V1_2)
+        #if defined(HELTEC_V3) || defined(HELTEC_WS) || defined(LIGHTGATEWAY_1_0) || defined(TTGO_LORA32_T3S3_V1_2) || defined(ESP32_C3_SUPERMINI)
             Wire.begin(OLED_SDA, OLED_SCL);
         #endif
```

Voy a confesar que es posible que haya alguna errata ah√≠ arriba, he toqueteado el diff un
poco a lo juan palomo. Pero bueno, en resumen los cambios ser√≠an:
1. A√±adir un nuevo entorno (env) con nuestra placa y lo que haga falta configurarle.
2. Definir los pines que usar√° nuestra placa para la macro definida en el punto 1
   (ESP32_C3_SUPERMINI).
3. Usar esa misma macro si hace falta para configurar otras cosas, en este caso he tenido
   que usarla para decirle que use pines customizados para la pantalla oled y para
   decirle que evidentemente tiene pantalla oled.

Y es que platformIO es una maravilla, ahora puedo elegir esa placa que he configurado y
ya compila e instala todo lo necesario para que funcione. Shame on you arduino, shame on
you...

Se puede ver que en un principio pens√© en a√±adirle el m√≥dulo de GPS pero esto ni he
probado si funcionaba porque me da un poco igual. Pero en general, antes de pasar al
siguiente punto de este post, lo suyo ser√≠a haber probado que el c√≥digo funciona bien
usando la protoboard con los cablecitos. Los cablecitos dan asco, fallan mucho, dan
problemas pero... ¬°Se pueden quitar y cambiar f√°cil! ¬°Una vez sueldes las cosas te vas a
lamentar si falla!

# 3. Dise√±ando con el paint
No acabo de encontrar una herramienta para linux que me sea tan c√≥moda para cosas
sencillas como el paint de marras. Est√° inkscape pero tiene tantas cosas que, para algo
simple, me da hasta pereza abrir el programa.

Para empezar a "dise√±ar" primero creo la cuadricula que representan los puntos 
soldables y los m√≥dulos con el tama√±o que ocupan seg√∫n esa cuadr√≠cula. Asegur√°ndome bien
de que los pines encajen bien en los cuadrados y tambi√©n el tama√±o y distancia de estos.
As√≠ no hay problemas luego al pasarlos a la realidad y que tropiecen los m√≥dulos.

![Paint componentes PCB]({{site.url}}/assets/images/paint_pcb/pcb_components_paint.png "Dibujo de los componentes que se usar√°n para el dise√±o de pistas")

Para dise√±ar los m√≥dulos suelo partir de una cuadricula, poner los pines y luego el
contorno que ocupan. Y le a√±ado alg√∫n detallito para que se vea lo que es y tambi√©n la
leyenda de cada pin, que esto ayudar√° luego a cablear/hacer las pistas.

Antes de ponerme a hacer pistas sobre la cuadricula las hago sin gu√≠a para hacerme una
idea para probar a conectar todo sin engorros. La idea al dise√±ar pistas es que tienes
que conectar todo sin que una pista atraviese a otra. Por lo tanto cada pista que a√±ades
va limitando las siguientes, el orden y la posici√≥n de los elementos afecta bastante.

Para este circuito, como ya he mencionado, voy a usar una placa ["esp32-c3 supermini"](https://forum.arduino.cc/t/esp32-c3-supermini-pinout/1189850).
Este es un caso particular, ya que esta placa se puede soldar directamente sobre los pads
de cobre de una pcb, as√≠ que por eso si os fij√°is en la parte de arriba lo he puesto por 
la parte de arriba y por la de abajo. Por ver c√≥mo me pillaba mejor para ahorrar espacio.

> Con pad me refiero a cada uno de los circulitos de cobre por d√≥nde se pasan los 
  pines/cables y se sueldan, cada pad es un cuadradito de nuestra cuadr√≠cula.

Para las conexiones hay que ir fij√°ndose en los pines definidos en el c√≥digo que he 
ense√±ado en el punto anterior.

Aqu√≠ un posible dise√±o:

![Dise√±o pistas sin cuadricula]({{site.url}}/assets/images/paint_pcb/pistas.png "dise√±o de las pistas del circuito a mano alzada")

Las reglas m√°s o menos son:
1. Las pistas nunca deben pisarse, si se pisan est√°s cortocircuit√°ndolas y a efectos 
   pr√°cticos son la misma conexi√≥n. El √∫nico caso que v√©is ah√≠ que se pisa, al que le he 
   puesto una l√≠nea m√°s fina, es porque har√© un "puente". Es decir: voy a sacar un cable 
   hac√≠a arriba para poder saltar por encima de las pistas. Hay que evitar los puentes 
   siempre que se pueda, cuantos menos de estos, m√°s calidad y m√°s c√≥modidad luego.
2. Las pistas no pueden pasar por debajo de pines, esos pines ir√°n soldados a un pad y 
   como ense√±ar√© luego, los pads nos servir√°n para trazar las pistas saltando de uno a
   otro. Por lo que el pad de esa posici√≥n est√° ocupado.
3. Las pistas girar√°n en √°ngulos rectos. Fun fact: si el profesor que me ense√±√≥ a dise√±ar
   PCBs con el orcad viese esto me matar√≠a jajaja porque al dise√±ar pistas siempre te
   dicen que hay que dise√±ar pistas sin √°ngulos rectos (si no recuerdo mal porque los 
   √°ngulos demasiado cerrados actuaban como un condensador y afectaba al circuito).
   Pero cre√©me que te har√° falta, en diagonal no vas a poder juntar pads y no acaba de
   ser un √°ngulo estrictamente recto al final.
4. No conf√≠es en que este primer esbozo te sirve, es para orientarte en c√≥mo ubicar las
   cosas sobre el tablero. Pero luego con la pcb tienes m√°s limitaciones para hacer
   pistas en cuanto a longitud y cantidad.


Aqu√≠ la herramienta de recorte con fondo transparente va a ser tu nuevo dios para
sobreponer unas cosas encima de otras. 

Aqu√≠ os ense√±o c√≥mo qued√≥ el dise√±o que hice:

![Dise√±o pistas sobre cuadr√≠cula]({{site.url}}/assets/images/paint_pcb/pcb_layer_design.png "dise√±o de las pistas del circuito ya sobre los pad de la placa")

Si os fij√°is, he puesto la misma imagen pero la segunda est√° en espejo. Esto es porque a
la hora de crear las pistas con el soldador nos vamos a guiar por esta segunda imagen, ya
que le daremos la vuelta. ¬°La primera para dise√±ar sin l√≠arnos! Y una vez est√© se
transforma a espejo.

Para crear las pistas (supongo que no es necesario especificar que usando el soldador) lo
que yo hago es ir haciendo una bolita en cada pad y luego ir uni√©ndolas con la calmita. 
Hay que esperar a que vaya enfr√≠ando cada uni√≥n para juntarlas entre ellas. Si est√° todo 
caliente se separar√°n. En aspectos generales la t√©cnica consiste en hacer todo tipo de 
cosas por las que un ingeniero electr√≥nico se llevase las manos a la cabeza al verte jaja

Aqu√≠ se puede ver el resultado por ambos lados, que se ve mucho m√°s limpio que el
anterior con tanto cable:

![PCB final ambos lados]({{site.url}}/assets/images/paint_pcb/final_pcb_both_sides.jpg "PCB acabada por ambos lados")

He grabado un video haciendo toda la placa y lo he puesto a 2x, no es que sea de mucha
calidad pero si alguien quiere verlo lo he subido a YouTube, mejor explicaci√≥n que verlo
no hay:

<iframe width="560" height="315" src="https://www.youtube.com/embed/WOp2VozggBc?si=cRBvbu_rW3thCuGD" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe><br>

El espacio asignado para subir posts a este blog es de s√≥lo 1 GiB y claro, no cabe el
video. As√≠ que a partir de ahora, ¬øqui√©n sabe si ahora me dar√° por subir alg√∫n video m√°s
a youtube? Igual hasta en alguno hablo jajaj

Espero que os haya gustado este post y le haya servido a alguien. ¬°Hasta el pr√≥ximo!

# Enlaces de inter√©s
* [APRS](https://en.wikipedia.org/wiki/Automatic_Packet_Reporting_System)
* [GitHub de Lora APRS tracker](https://github.com/lora-aprs/LoRa_APRS_Tracker)
* [GitHub de Lora APRS iGate](https://github.com/richonguzman/LoRa_APRS_iGate)